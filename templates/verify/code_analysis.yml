parameters:
  - name: stage_name
    type: string

  - name: dependsOn
    type: object

  - name: folder
    type: string

resources:
  repositories:
    - repository: security_check
      type: github
      name: NovoNordisk-OpenSource/security_check
      endpoint: GH_public_service_connection


stages:
  - stage: ${{ parameters.stage_name }}
    dependsOn: ${{ parameters.dependsOn }}
    jobs:
      - job: Check_against_compliance
        steps:
          - checkout: none

          - script: |
              echo "This step is currently not enabled."
              #cp -r /mnt/cache/$(Build.Repository.Name)_cache/$(Build.BuildId)/cdk.out .
            displayName: Restore caches
            workingDirectory: $(System.DefaultWorkingDirectory)

          - script: |
              pwd
              ls
            displayName: Run CFN-GUARD
  - name: Security Check
    uses: nn-dma/security_check@main
    with:
      SnykToken: ${{ secrets.SNYK_TOKEN }}
      Pipeline_Run: ${{ github.run_id}}
